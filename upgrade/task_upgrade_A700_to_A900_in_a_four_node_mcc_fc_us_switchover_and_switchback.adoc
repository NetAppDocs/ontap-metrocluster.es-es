---
permalink: upgrade/task_upgrade_A700_to_A900_in_a_four_node_mcc_fc_us_switchover_and_switchback.html 
sidebar: sidebar 
keywords: metrocluster, upgrade, controllers, switchover, switchback, fc, configuration, net, boot, root, aggregate, mcc 
summary: 'Puede utilizar la operación de conmutación de sitios de MetroCluster para proporcionar un servicio no disruptivo a los clientes mientras se actualizan los módulos de la controladora del clúster de partners. Como parte de este procedimiento, no se pueden actualizar otros componentes (como bandejas de almacenamiento o switches).' 
---
= Actualice controladoras de AFF A700/FAS9000 a AFF A900/FAS9500 en una configuración FC de MetroCluster mediante conmutación de sitios y conmutación de estado (ONTAP 9.10.1 o posterior).
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Puede utilizar la operación de conmutación de sitios de MetroCluster para proporcionar un servicio no disruptivo a los clientes mientras se actualizan los módulos de la controladora del clúster de partners. No puede actualizar otros componentes (como bandejas de almacenamiento o switches) como parte de este procedimiento.

.Acerca de esta tarea
* Este procedimiento solo se puede usar para actualizar la controladora.
+
No puede actualizar otros componentes de la configuración, como bandejas de almacenamiento o switches, al mismo tiempo.

* Puede utilizar este procedimiento para actualizar un AFF A700 a AFF A900 con ONTAP 9.10.1 y posterior.
* Puede utilizar este procedimiento para actualizar un FAS9000 a FAS9500 con ONTAP 9.10.1P3 y posterior.
+
** ONTAP 9.10.1 y versiones posteriores admiten configuraciones de cuatro y ocho nodos.
+

NOTE: El sistema AFF A900 sólo es compatible con ONTAP 9.10.1 o posterior.

+
https://hwu.netapp.com/["Hardware Universe de NetApp"^]



* Todas las controladoras de la configuración deben actualizarse durante el mismo período de mantenimiento.
+
La siguiente tabla muestra la matriz de modelos compatible para la actualización de la controladora.

+
|===


| Modelo de plataforma anterior | Nuevo modelo de plataforma 


 a| 
** A700 de AFF

 a| 
** AFF A900




 a| 
** FAS9000

 a| 
** FAS9500


|===
* Durante el procedimiento de actualización, es necesario cambiar la estructura de MetroCluster, incluidos el RCF y los cambios físicos del cableado. Puede realizar los cambios en el cableado y el RCF antes de realizar la actualización del controlador.
* Este procedimiento de actualización no requiere que no se cambien las conexiones de almacenamiento, FC y Ethernet entre los nodos originales y los nuevos.
* Durante el procedimiento de actualización, no debe añadir ni quitar otras tarjetas del sistema A700 o FAS9000 de AFF. Para obtener más información, consulte https://hwu.netapp.com/["Hardware Universe de NetApp"^]


Los nombres de ejemplo siguientes se utilizan en ejemplos y gráficos de este procedimiento:

* Sitio_a
+
** Antes de la actualización:
+
*** Node_a_1-A700
*** Node_a_2-A700


** Después de la actualización:
+
*** Node_A_1-A900
*** Node_A_2-A900




* Centro_B
+
** Antes de la actualización:
+
*** Node_B_1-A700
*** Node_B_2-A700


** Después de la actualización:
+
*** Node_B_1-A900
*** Node_B_2-A900








== Active el registro de la consola

NetApp recomienda encarecidamente que habilite el inicio de sesión de la consola en los dispositivos que esté utilizando y realice las siguientes acciones al realizar este procedimiento:

* Deje la función AutoSupport habilitada durante el mantenimiento.
* Active un mensaje de AutoSupport de mantenimiento antes y después de las tareas de mantenimiento para deshabilitar la creación de casos durante la actividad de mantenimiento.
+
Consulte el artículo de la base de conocimientos link:https://kb.netapp.com/Support_Bulletins/Customer_Bulletins/SU92["Cómo impedir la creación automática de casos durante las ventanas de mantenimiento programado"^].

* Habilite el registro de sesiones para cualquier sesión de CLI. Para obtener instrucciones sobre cómo activar el registro de sesiones, consulte la sección Salida de sesión de registro en el artículo de la Base de conocimientos link:https://kb.netapp.com/on-prem/ontap/Ontap_OS/OS-KBs/How_to_configure_PuTTY_for_optimal_connectivity_to_ONTAP_systems["Cómo configurar PuTTY para una conectividad óptima con sistemas ONTAP"^].




== Prepare la actualización

Antes de realizar cambios en la configuración de MetroCluster existente, debe comprobar el estado de la configuración, cambiar los archivos RCF y el cableado para que coincidan con la topología de conectividad de puerto nueva necesaria para la configuración de la estructura AFF A900 o FAS9000 MetroCluster y realizar otras tareas diversas.



== Borre la ranura 7 del controlador AFF A700

La configuración de MetroCluster en un AFF A900 o FAS9500 requiere 8 puertos FC-VI en las tarjetas FC-VI en las ranuras 5 y 7. Antes de iniciar la actualización, si hay tarjetas en la ranura 7 en el A700 o FAS9000 de AFF, debe moverlas a otras ranuras para todos los nodos del clúster.



=== Compruebe el estado de la configuración de MetroCluster

Antes de actualizar los archivos RCF y el cableado de la configuración de MetroCluster estructural AFF A900 o FAS9500, debe comprobar el estado y la conectividad de la configuración.


CAUTION: del Este error indica una discrepancia en el tamaño de la NVRAM entre los nodos de cada sitio y es el comportamiento esperado cuando hay diferentes modelos de plataforma en ambos sitios. grupo de recuperación ante desastres.

.Pasos
. Compruebe el funcionamiento de la configuración de MetroCluster en ONTAP:
+
.. Compruebe si los nodos son multipathed: +
`node run -node _node-name_ sysconfig -a`
+
Debe emitir este comando para cada nodo en la configuración de MetroCluster.

.. Compruebe que no hay discos rotos en la configuración:
+
`storage disk show -broken`

+
Debe emitir este comando en cada nodo de la configuración de MetroCluster.

.. Compruebe cualquier alerta de estado:
+
`system health alert show`

+
Debe emitir este comando en cada clúster.

.. Verifique las licencias en los clústeres:
+
`system license show`

+
Debe emitir este comando en cada clúster.

.. Compruebe los dispositivos conectados a los nodos:
+
`network device-discovery show`

+
Debe emitir este comando en cada clúster.

.. Compruebe que la zona horaria y la hora están configuradas correctamente en ambos sitios:
+
`cluster date show`

+
Debe emitir este comando en cada clúster. Puede utilizar el `cluster date` para configurar la hora y la zona horaria.



. Compruebe si hay alertas de estado en los switches (si existen):
+
`storage switch show`

+
Debe emitir este comando en cada clúster.

. Confirmar el modo operativo de la configuración de MetroCluster y realizar una comprobación de MetroCluster.
+
.. Confirme la configuración del MetroCluster y que el modo operativo es normal:
+
`metrocluster show`

.. Confirme que se muestran todos los nodos esperados:
+
`metrocluster node show`

.. Emita el siguiente comando:
+
`metrocluster check run`

.. Mostrar los resultados de la comprobación de MetroCluster:
+
`metrocluster check show`



. Compruebe el cableado MetroCluster con la herramienta Config Advisor.
+
.. Descargue y ejecute Config Advisor.
+
https://mysupport.netapp.com/site/tools/tool-eula/activeiq-configadvisor["Descargas de NetApp: Config Advisor"^]

.. Después de ejecutar Config Advisor, revise el resultado de la herramienta y siga las recomendaciones del resultado para solucionar los problemas detectados.






=== Actualice los archivos RCF del switch estructural

La estructura MetroCluster A900 o FAS9500 de AFF requiere dos adaptadores de cuatro puertos FC-VI por nodo, en comparación con un único adaptador FC-VI de cuatro puertos requerido por un A700 de AFF. Antes de iniciar la actualización del controlador al controlador AFF A900 o FAS9500, debe modificar los archivos RCF del conmutador de estructura para admitir la topología de conexión AFF A900 o FAS9500.

. Desde la https://mysupport.netapp.com/site/products/all/details/metrocluster-rcf/downloads-tab["Página de descarga de archivos RCF de MetroCluster"^], Descargue el archivo RCF correcto para un MetroCluster de estructura AFF A900 o FAS9500 y el modelo de switch que se utiliza en la configuración AFF A700 o FAS9000.
. [[Update-RCF]]Actualice el archivo RCF en los conmutadores a de la estructura, cambie A1 y cambie B1 siguiendo los pasos de link:../disaster-recovery/task_cfg_switches_mcfc.html["Configurar los switches FC"].
+

NOTE: La actualización de archivos RCF para admitir la configuración de MetroCluster estructural AFF A900 o FAS9500 no afecta al puerto y las conexiones utilizadas para la configuración de AFF A700 o FAS9000 Fabric MetroCluster.

. Después de actualizar los archivos RCF en los switches de la estructura A, todas las conexiones de almacenamiento y FC-VI deben conectarse. Verificar las conexiones FC-VI:
+
`metrocluster interconnect mirror show`

+
.. Compruebe que los discos de sitio local y remoto aparecen en la `sysconfig` salida.


. [[verify-sand]]debe verificar que MetroCluster esté en buen estado después de la actualización del archivo RCF para los conmutadores de la estructura A.
+
.. Compruebe las conexiones del grupo de metro:
`metrocluster interconnect mirror show`
.. Ejecutar comprobación de MetroCluster:
`metrocluster check run`
.. Vea los resultados de la ejecución de MetroCluster cuando finalice la ejecución:
`metrocluster check show`


. Actualice los switches de la estructura B (switches 2 y 4) repitiendo <<Update-RCF,Paso 2>> para <<verify-healthy,Paso 5>>.




=== Compruebe el estado de la configuración de MetroCluster después de la actualización del archivo RCF

Antes de realizar la actualización, debe verificar el estado y la conectividad de la configuración de MetroCluster.

.Pasos
. Compruebe el funcionamiento de la configuración de MetroCluster en ONTAP:
+
.. Compruebe si los nodos son multipathed: +
`node run -node _node-name_ sysconfig -a`
+
Debe emitir este comando para cada nodo en la configuración de MetroCluster.

.. Compruebe que no hay discos rotos en la configuración:
+
`storage disk show -broken`

+
Debe emitir este comando en cada nodo de la configuración de MetroCluster.

.. Compruebe cualquier alerta de estado:
+
`system health alert show`

+
Debe emitir este comando en cada clúster.

.. Verifique las licencias en los clústeres:
+
`system license show`

+
Debe emitir este comando en cada clúster.

.. Compruebe los dispositivos conectados a los nodos:
+
`network device-discovery show`

+
Debe emitir este comando en cada clúster.

.. Compruebe que la zona horaria y la hora están configuradas correctamente en ambos sitios:
+
`cluster date show`

+
Debe emitir este comando en cada clúster. Puede utilizar el `cluster date` para configurar la hora y la zona horaria.



. Compruebe si hay alertas de estado en los switches (si existen):
+
`storage switch show`

+
Debe emitir este comando en cada clúster.

. Confirmar el modo operativo de la configuración de MetroCluster y realizar una comprobación de MetroCluster.
+
.. Confirme la configuración del MetroCluster y que el modo operativo es normal:
+
`metrocluster show`

.. Confirme que se muestran todos los nodos esperados:
+
`metrocluster node show`

.. Emita el siguiente comando:
+
`metrocluster check run`

.. Mostrar los resultados de la comprobación de MetroCluster:
+
`metrocluster check show`



. Compruebe el cableado MetroCluster con la herramienta Config Advisor.
+
.. Descargue y ejecute Config Advisor.
+
https://mysupport.netapp.com/site/tools/tool-eula/activeiq-configadvisor["Descargas de NetApp: Config Advisor"^]

.. Después de ejecutar Config Advisor, revise el resultado de la herramienta y siga las recomendaciones del resultado para solucionar los problemas detectados.






=== Asigne los puertos de los nodos A700 o FAS9000 de AFF a los nodos A900 o FAS9500 de AFF

Durante el proceso de actualización de la controladora, solo se deben cambiar las conexiones que se mencionan en este procedimiento.

Si las controladoras A700 o FAS9000 de AFF tienen una tarjeta en la ranura 7, debe moverla a otra ranura antes de iniciar el procedimiento de actualización de la controladora. Debe disponer de la ranura 7 para añadir el segundo adaptador FC-VI necesario para el funcionamiento de Fabric MetroCluster en los controladores AFF A900 o FAS9500.



=== Recopile información antes de la actualización

Antes de actualizar, se debe recopilar información sobre cada uno de los nodos antiguos y, si es necesario, ajustar los dominios de retransmisión de red, quitar las VLAN y los grupos de interfaces, y recopilar información de cifrado.

.Acerca de esta tarea
Esta tarea se realiza en la configuración existente de MetroCluster FC.

.Pasos
. Recopile los ID del sistema del nodo de configuración MetroCluster:
+
`metrocluster node show -fields node-systemid,dr-partner-systemid`

+
Durante el procedimiento de actualización, reemplazará estos antiguos ID del sistema por los ID del sistema de los módulos del controlador.

+
En este ejemplo de una configuración FC de MetroCluster de cuatro nodos, se recuperan los siguientes ID del sistema antiguos:

+
** Node_A_1-A700: 537037649
** Node_A_2-A700: 537407030
** Node_B_1-A700: 0537407114
** Node_B_2-A700: 537035354


+
[listing]
----
Cluster_A::*> metrocluster node show -fields node-systemid,ha-partner-systemid,dr-partner-systemid,dr-auxiliary-systemid
dr-group-id cluster    node           node-systemid ha-partner-systemid dr-partner-systemid dr-auxiliary-systemid
----------- ------------------------- ------------- ------------------- ------------------- ---------------------
1           Cluster_A  nodeA_1-A700   537407114     537035354           537411005           537410611
1           Cluster_A  nodeA_2-A700   537035354     537407114           537410611           537411005
1           Cluster_B  nodeB_1-A700   537410611     537411005           537035354           537407114
1           Cluster_B  nodeB_2-A700   537411005

4 entries were displayed.
----
. Recopile información del puerto y LIF para cada nodo antiguo.
+
Debe recopilar el resultado de los siguientes comandos para cada nodo:

+
** `network interface show -role cluster,node-mgmt`
** `network port show -node _node-name_ -type physical`
** `network port vlan show -node _node-name_`
** `network port ifgrp show -node _node_name_ -instance`
** `network port broadcast-domain show`
** `network port reachability show -detail`
** `network ipspace show`
** `volume show`
** `storage aggregate show`
** `system node run -node _node-name_ sysconfig -a`


. Si los nodos MetroCluster tienen una configuración SAN, recopile la información pertinente.
+
Debe recopilar el resultado de los siguientes comandos:

+
** `fcp adapter show -instance`
** `fcp interface show -instance`
** `iscsi interface show`
** `ucadmin show`


. Si el volumen raíz está cifrado, recopile y guarde la clave de acceso usada para Key-Manager:
+
`security key-manager backup show`

. Si los nodos de MetroCluster utilizan el cifrado de volúmenes o agregados, copie información sobre las claves y las Passphrases.
+
Para obtener más información, consulte https://docs.netapp.com/us-en/ontap/encryption-at-rest/backup-key-management-information-manual-task.html["Realizar un backup manual de la información de gestión de claves incorporada"^].

+
.. Si se configuró el gestor de claves incorporado:
+
`security key-manager onboard show-backup`

+
Necesitará la contraseña más adelante en el procedimiento de actualización.

.. Si está configurada la gestión de claves empresariales (KMIP), ejecute los siguientes comandos:
+
`security key-manager external show -instance`

+
`security key-manager key query`







=== Elimine la configuración existente del tiebreaker o del otro software de supervisión

Si la configuración existente se supervisa con la configuración de tiebreaker para MetroCluster u otras aplicaciones de terceros (por ejemplo, ClusterLion) que pueden iniciar una conmutación de sitios, debe eliminar la configuración de MetroCluster del tiebreaker o de otro software antes de la transición.

.Pasos
. Elimine la configuración de MetroCluster existente del software Tiebreaker.
+
link:../tiebreaker/concept_configuring_the_tiebreaker_software.html#remove-metrocluster-configurations["Eliminar las configuraciones de MetroCluster"]

. Elimine la configuración de MetroCluster existente de cualquier aplicación de terceros que pueda iniciar la conmutación.
+
Consulte la documentación de la aplicación.





=== Envíe un mensaje de AutoSupport personalizado antes de realizar el mantenimiento

Antes de realizar el mantenimiento, debe emitir un mensaje de AutoSupport para notificar al soporte técnico de NetApp que se está realizando el mantenimiento. Al informar al soporte técnico de que el mantenimiento está en marcha, se evita que abran un caso basándose en que se ha producido una interrupción.

.Acerca de esta tarea
Esta tarea debe realizarse en cada sitio MetroCluster.

.Pasos
. Para evitar la generación automática de casos de soporte, envíe un mensaje de AutoSupport para indicar que está en curso el mantenimiento.
+
.. Emita el siguiente comando:
+
`system node autosupport invoke -node * -type all -message MAINT=__maintenance-window-in-hours__`

+
`maintenance-window-in-hours` especifica la longitud de la ventana de mantenimiento, con un máximo de 72 horas. Si el mantenimiento se completa antes de que haya transcurrido el tiempo, puede invocar un mensaje de AutoSupport que indique el final del período de mantenimiento:

+
`system node autosupport invoke -node * -type all -message MAINT=end`

.. Repita el comando en el clúster de partners.






== Cambie la configuración de MetroCluster

Debe cambiar la configuración a site_A para que las plataformas en site_B puedan actualizarse.

.Acerca de esta tarea
Esta tarea debe realizarse en site_A.

Tras completar esta tarea, el sitio_A está activo y está sirviendo datos para ambos sitios. El centro_B está inactivo y listo para comenzar el proceso de actualización, como se muestra en la siguiente ilustración. (Esta ilustración también se aplica a la actualización de FAS9000 a una controladora FAS9500).

image::../media/mcc_upgrade_cluster_a_in_switchover_A900.png[Sitio_B inactivo y listo para actualizar]

.Pasos
. Cambie de la configuración de MetroCluster a site_A para que los nodos de site_B puedan actualizarse:
+
.. Emita el siguiente comando en site_A:
+
`metrocluster switchover -controller-replacement true`

+
La operación puede tardar varios minutos en completarse.

.. Supervise la operación de switchover:
+
`metrocluster operation show`

.. Una vez finalizada la operación, confirme que los nodos están en estado de conmutación:
+
`metrocluster show`

.. Compruebe el estado de los nodos de MetroCluster:
+
`metrocluster node show`



. Reparar los agregados de datos.
+
.. Reparar los agregados de datos:
+
`metrocluster heal data-aggregates`

.. Para confirmar que se completa la operación de curación, ejecute el `metrocluster operation show` comando en el clúster en buen estado:
+
[listing]
----

cluster_A::> metrocluster operation show
  Operation: heal-aggregates
      State: successful
 Start Time: 7/29/2020 20:54:41
   End Time: 7/29/2020 20:54:42
     Errors: -
----


. Reparar los agregados raíz.
+
.. Reparar los agregados de datos:
+
`metrocluster heal root-aggregates`

.. Para confirmar que se completa la operación de curación, ejecute el `metrocluster operation show` comando en el clúster en buen estado:
+
[listing]
----

cluster_A::> metrocluster operation show
  Operation: heal-root-aggregates
      State: successful
 Start Time: 7/29/2020 20:58:41
   End Time: 7/29/2020 20:59:42
     Errors: -
----






== Quite el módulo de la controladora A700 o FAS9000 de AFF y el NVS en site_B

Debe eliminar las controladoras antiguas de la configuración.

Esta tarea se realiza en el sitio_B.

.Antes de empezar
Si usted no está ya conectado a tierra, correctamente tierra usted mismo.

.Pasos
. Conéctese a la consola de serie de las controladoras antiguas (node_B_1-700 y node_B_2-700) en Site_B y compruebe que muestra el `LOADER` prompt.
. Recopile los valores bootarg de ambos nodos en site_B: `printenv`
. Apague el chasis en el sitio_B.




== Quite el módulo de la controladora y el NVS de ambos nodos en Site_B



=== Quite el módulo de controladoras A700 o FAS9000 de AFF

Siga el siguiente procedimiento para quitar el módulo de controladoras A700 o FAS9000 de AFF.

.Pasos
. Desconecte el cable de consola, si lo hay, y el cable de administración del módulo del controlador antes de extraer el módulo del controlador.
. Desbloquee y extraiga el módulo de la controladora del chasis.
+
.. Deslice el botón naranja del asa de la leva hacia abajo hasta que se desbloquee.
+
image:../media/drw_9500_remove_PCM.png["controladora"]

+
|===


| image:../media/number1.png["número 1"] | Botón de liberación de la palanca de leva 


| image:../media/number2.png["número 2"] | Mango de leva 
|===
.. Gire el asa de leva para que desacople completamente el módulo del controlador del chasis y, a continuación, deslice el módulo del controlador para sacarlo del chasis. Asegúrese de que admite la parte inferior del módulo de la controladora cuando la deslice para sacarlo del chasis.






=== Retire el módulo NVS A700 o FAS9000 de AFF

Siga el procedimiento siguiente para extraer el módulo AFF A700 o FAS9000 NVS.


NOTE: El módulo NVS A700 o FAS9000 de AFF se encuentra en la ranura 6 y tiene el doble de altura que los otros módulos del sistema.

. Desbloquee y retire el NVS de la ranura 6.
+
.. Pulse el botón de leva numerado y con letras. El botón de leva se aleja del chasis.
.. Gire el pestillo de la leva hacia abajo hasta que esté en posición horizontal. El NVS se desconecta del chasis y se mueve unas pocas pulgadas.
.. Extraiga el NVS del chasis tirando de las lengüetas de tiro situadas en los lados de la cara del módulo.
+
image:../media/drw_a900_move-remove_NVRAM_module.png["Módulo NVS"]

+
|===


| image:../media/number1.png["número 1"] | Pestillo de leva de E/S numerado y con letras 


| image:../media/number2.png["número 2"] | Pestillo de I/o completamente desbloqueado 
|===




[NOTE]
====
* No transfiera ningún módulo adicional utilizado como dispositivos coredump en el módulo de almacenamiento no volátil AFF A700 de la ranura 6 al módulo NVS AFF A900. No transfiera ninguna pieza del controlador AFF A700 ni de los módulos NVS al módulo del controlador AFF A900.
* Para actualizaciones de FAS9000 a FAS9500, solo debe transferir módulos Flash Cache en el módulo NVS de FAS9000 al módulo NVS de FAS9500 GB. No transfiera ninguna otra pieza del controlador FAS9000 y los módulos NVS al módulo del controlador FAS9500.


====


== Instale el módulo controlador y los NVS AFF A900 o FAS9500

Debe instalar los NVS y el módulo controlador AFF A900 o FAS9500 desde el kit de actualización en ambos nodos de Site_B. No mueva el dispositivo coredump desde el módulo AFF A700 o FAS9000 NVS hasta el módulo NVS AFF A900 o FAS9500.

.Antes de empezar
Si usted no está ya conectado a tierra, correctamente tierra usted mismo.



=== Instale los NVS AFF A900 o FAS9500

Siga este procedimiento para instalar el sistema AFF A900 o el sistema FAS9500 NVS en la ranura 6 de ambos nodos en el sitio_B

.Pasos
. Alinee el NVS con los bordes de la abertura del chasis en la ranura 6.
. Deslice suavemente el NVS en la ranura hasta que el pestillo de leva de E/S con letras y números comience a acoplarse con el pasador de leva de E/S y, a continuación, empuje el pestillo de leva de E/S hasta que encaje el NVS en su sitio.
+
image:../media/drw_a900_move-remove_NVRAM_module.png["Módulo NVS"]

+
|===


| image:../media/number1.png["número 1"] | Pestillo de leva de E/S numerado y con letras 


| image:../media/number2.png["número 2"] | Pestillo de I/o completamente desbloqueado 
|===




=== Instale el módulo del controlador AFF A900 o FAS9500

Siga el procedimiento siguiente para instalar el módulo del controlador AFF A900 o FAS9500.

.Pasos
. Alinee el extremo del módulo del controlador con la abertura del chasis y, a continuación, empuje suavemente el módulo del controlador hasta la mitad del sistema.
. Empuje firmemente el módulo de la controladora en el chasis hasta que se ajuste al plano medio y esté totalmente asentado. El pestillo de bloqueo se eleva cuando el módulo del controlador está completamente asentado.
+

CAUTION: No ejerza una fuerza excesiva al deslizar el módulo del controlador hacia el chasis para evitar dañar los conectores.

. Conecte los puertos de consola y gestión al módulo de la controladora.
+
image:../media/drw_9500_remove_PCM.png["controladora"]

+
|===


| image:../media/number1.png["número 1"] | Botón de liberación de la palanca de leva 


| image:../media/number2.png["número 2"] | Mango de leva 
|===
. Instale la segunda tarjeta X91129A en la ranura 7 de cada nodo.
+
.. Conecte los puertos FC-VI de la ranura 7 a los switches. Consulte la link:../install-fc/index.html["Instalación y configuración FAS"] Documentación y vaya a los requisitos de conexión de la estructura MetroCluster A900 o FAS9500 de AFF para el tipo de switch de su entorno.


. ENCIENDA el chasis y conéctelo a la consola de serie.
. Tras la inicialización del BIOS, si el nodo inicia el autoarranque, interrumpa el ARRANQUE AUTOMÁTICO pulsando Control-C.
. Después de interrumpir el arranque automático, los nodos se detienen en el símbolo del sistema DEL CARGADOR. Si no interrumpe el arranque automático a la hora y el nodo 1 comienza a arrancar, espere a que pulse Control-C para entrar en el menú de arranque. Después de que el nodo se detenga en el menú de arranque, utilice la opción 8 para reiniciar el nodo e interrumpir el arranque automático durante el reinicio.
. En la `LOADER` defina las variables de entorno predeterminadas: `set-defaults`
. Guarde la configuración predeterminada de las variables de entorno: `saveenv`




=== Reiniciar el sistema de los nodos en el sitio_B

Tras intercambiar el módulo de controladoras AFF A900 o FAS9500 y NVS, debe reiniciar el sistema de los nodos AFF A900 o FAS9500 e instalar la misma versión de ONTAP y el nivel de revisión que se ejecuta en el clúster. El término `netboot` Significa que está arrancando desde una imagen ONTAP almacenada en un servidor remoto. Al prepararse para `netboot`, Debe agregar una copia de la imagen de inicio de ONTAP 9 a un servidor Web al que pueda acceder el sistema.

No es posible comprobar la versión de ONTAP instalada en los medios de arranque de un módulo de controlador AFF A900 o FAS9500 a menos que esté instalado en un chasis Y ENCENDIDO. La versión de ONTAP en los medios de arranque AFF A900 o FAS9500 debe ser la misma que la versión de ONTAP que se ejecuta en el sistema A700 o FAS9000 de AFF que se está actualizando, y las imágenes de arranque principal y de backup deben coincidir. Puede configurar las imágenes realizando una `netboot` seguido de `wipeconfig` desde el menú de arranque. Si el módulo de la controladora se usaba anteriormente en otro clúster, el `wipeconfig` el comando borra toda la configuración residual del soporte de arranque.

.Antes de empezar
* Compruebe que puede acceder a un servidor HTTP con el sistema.
* Es necesario descargar los archivos del sistema necesarios para el sistema y la versión correcta de ONTAP desde link:https://mysupport.netapp.com/site/["Soporte de NetApp"^] sitio. Acerca de esta tarea que debe realizar `netboot` Las nuevas controladoras si la versión de ONTAP instalada no es la misma que la versión instalada en las controladoras originales. Tras instalar cada controladora nueva, arranque el sistema desde la imagen de ONTAP 9 almacenada en el servidor web. A continuación, puede descargar los archivos correctos en el dispositivo multimedia de arranque para posteriores arranques del sistema.


.Pasos
. Acceso link:https://mysupport.netapp.com/site/["Soporte de NetApp"^] para descargar los archivos necesarios para realizar un arranque del sistema utilizado para reiniciar el sistema.
. [[paso2-download-software]]Descargue el software ONTAP adecuado desde la sección de descarga de software del sitio de soporte de NetApp y almacene el `<ontap_version>_image.tgz` archivo en un directorio accesible a través de la web.
. Cambie al directorio accesible a la Web y compruebe que los archivos que necesita están disponibles. Su lista de directorios debería contener `<ontap_version>_image.tgz`.
. Configure el `netboot` conexión eligiendo una de las siguientes acciones. Nota: Debe utilizar el puerto de gestión y la IP como `netboot` conexión. No utilice una IP de LIF de datos ni una interrupción del servicio de datos mientras se realiza la actualización.
+
|===


| Si el protocolo de configuración dinámica de hosts (DHCP) es... | Realice lo siguiente... 


| Ejecutando | Configure la conexión automáticamente mediante el siguiente comando en el símbolo del sistema del entorno de arranque:
`ifconfig e0M -auto` 


| No se está ejecutando | Configure manualmente la conexión mediante el siguiente comando en el símbolo del sistema del entorno de arranque:
`ifconfig e0M -addr=<filer_addr> -mask=<netmask> -gw=<gateway> - dns=<dns_addr> domain=<dns_domain>`

`<filer_addr>` Es la dirección IP del sistema de almacenamiento.
`<netmask>` es la máscara de red del sistema de almacenamiento.
`<gateway>` es la puerta de enlace del sistema de almacenamiento.
`<dns_addr>` Es la dirección IP de un servidor de nombres en la red. Este parámetro es opcional.
`<dns_domain>` Es el nombre de dominio del servicio de nombres de dominio (DNS). Este parámetro es opcional. NOTA: Es posible que se necesiten otros parámetros para la interfaz. Introduzca la ayuda ifconfig en el símbolo del sistema del firmware para obtener más información. 
|===
. Rendimiento `netboot` en el nodo 1:
`netboot http://<web_server_ip/path_to_web_accessible_directory>/netboot/kernel`La `<path_to_the_web-accessible_directory>` debería conducir al lugar en el que se ha descargado el `<ontap_version>_image.tgz` pulg <<step2-download-software,Paso 2>>.
+

NOTE: No interrumpa el arranque.

. Espere a que el nodo 1 que se está ejecutando en el módulo de controlador AFF A900 o FAS9500 arranque y muestre las opciones del menú de arranque como se muestra a continuación:
+
[listing]
----
Please choose one of the following:

(1)  Normal Boot.
(2)  Boot without /etc/rc.
(3)  Change password.
(4)  Clean configuration and initialize all disks.
(5)  Maintenance mode boot.
(6)  Update flash from backup config.
(7)  Install new software first.
(8)  Reboot node.
(9)  Configure Advanced Drive Partitioning.
(10) Set Onboard Key Manager recovery secrets.
(11) Configure node for external key management.
Selection (1-11)?
----
. En el menú de inicio, seleccione opción `(7) Install new software first`. Esta opción del menú descarga e instala la nueva imagen de ONTAP en el dispositivo de arranque.
+

NOTE: Ignore el siguiente mensaje: `This procedure is not supported for Non-Disruptive Upgrade on an HA pair.` Esta nota se aplica a actualizaciones de software ONTAP no disruptivas, y no a actualizaciones de controladoras. Utilice siempre netboot para actualizar el nodo nuevo a la imagen deseada. Si utiliza otro método para instalar la imagen en la nueva controladora, puede que se instale una imagen incorrecta. Este problema se aplica a todas las versiones de ONTAP.

. Si se le solicita que continúe el procedimiento, introduzca `y`, Y cuando se le solicite el paquete, escriba la dirección URL:
+
`\http://<web_server_ip/path_to_web-accessible_directory>/<ontap_version>_image.tgz`

. Lleve a cabo los siguientes pasos para reiniciar el módulo del controlador:
+
.. Ingresar `n` para omitir la recuperación de la copia de seguridad cuando vea el siguiente mensaje:
+
[listing]
----
Do you want to restore the backup configuration now? {y|n} n
----
.. Ingresar `y` para reiniciar cuando vea el siguiente mensaje:
+
`The node must be rebooted to start using the newly installed software. Do you want to reboot now? {y|n} y`

+
El módulo del controlador se reinicia pero se detiene en el menú de arranque porque se reformateó el dispositivo de arranque y es necesario restaurar los datos de configuración.

+

NOTE: Debe reiniciar el nodo para poder utilizar el software recién instalado.



. En el aviso, ejecute el `wipeconfig` comando para borrar cualquier configuración previa en el soporte de arranque:
+
.. Cuando vea el mensaje siguiente, responda `yes`:
`This will delete critical system configuration, including cluster membership.
Warning: do not run this option on a HA node that has been taken over.
Are you sure you want to continue?:`
.. El nodo se reinicia para finalizar el `wipeconfig` y luego se detiene en el menú de inicio.


. Seleccione opción `5` para pasar al modo de mantenimiento desde el menú de arranque. Responda `yes` en el símbolo del sistema hasta que el nodo se detenga en el modo de mantenimiento y en el símbolo del sistema `*>`.




=== Restaure la configuración de HBA

Dependiendo de la presencia y configuración de tarjetas HBA en el módulo de controlador, debe configurarlas correctamente para el uso de su sitio.

.Pasos
. En el modo de mantenimiento configure los ajustes para cualquier HBA del sistema:
+
.. Compruebe la configuración actual de los puertos: `ucadmin show`
.. Actualice la configuración del puerto según sea necesario.


+
|===


| Si tiene este tipo de HBA y el modo que desea... | Se usa este comando... 


 a| 
CNA FC
 a| 
`ucadmin modify -m fc -t initiator _adapter-name_`



 a| 
Ethernet de CNA
 a| 
`ucadmin modify -mode cna _adapter-name_`



 a| 
Destino FC
 a| 
`fcadmin config -t target _adapter-name_`



 a| 
Iniciador FC
 a| 
`fcadmin config -t initiator _adapter-name_`

|===




=== Establezca el estado de alta disponibilidad en las controladoras y el chasis nuevos

Debe comprobar el estado de alta disponibilidad de las controladoras y el chasis y, si es necesario, actualizar el estado para que coincida con la configuración del sistema.

.Pasos
. En el modo de mantenimiento, muestre el estado de alta disponibilidad del módulo de controladora y el chasis:
+
`ha-config show`

+
El estado de alta disponibilidad para todos los componentes debe ser mcc.

. Si el estado del sistema mostrado de la controladora o el chasis no es correcto, establezca el estado de alta disponibilidad:
+
`ha-config modify controller mcc`

+
`ha-config modify chassis mcc`

. Detenga el nodo: `halt`El nodo debe detenerse en la `LOADER>` prompt.
. En cada nodo, compruebe la fecha, la hora y la zona horaria del sistema: `Show date`
. Si es necesario, establezca la fecha en UTC o en la hora media de Greenwich (GMT): `set date <mm/dd/yyyy>`
. Compruebe la hora utilizando el siguiente comando en el símbolo del sistema del entorno de arranque: `show time`
. Si es necesario, establezca la hora en UTC o GMT: `set time <hh:mm:ss>`
. Guarde los ajustes: `saveenv`
. Recopile variables de entorno: `printenv`
. Vuelva a arrancar el nodo en modo de mantenimiento para permitir que los cambios de configuración surtan efecto:
`boot_ontap maint`
. Compruebe que los cambios realizados sean efectivos y ucadmin muestra los puertos iniciadores FC online.
+
|===


| Si tiene este tipo de HBA... | Utilizar este comando… 


 a| 
CNA
 a| 
`ucadmin show`



 a| 
FC
 a| 
`fcadmin show`

|===
. Compruebe el modo ha-config: `ha-config show`
+
.. Compruebe que dispone de la siguiente salida:
+
[listing]
----
*> ha-config show
Chassis HA configuration: mcc
Controller HA configuration: mcc
----






=== Establezca el estado de alta disponibilidad en las controladoras y el chasis nuevos

Debe comprobar el estado de alta disponibilidad de las controladoras y el chasis y, si es necesario, actualizar el estado para que coincida con la configuración del sistema.

.Pasos
. En el modo de mantenimiento, muestre el estado de alta disponibilidad del módulo de controladora y el chasis:
+
`ha-config show`

+
El estado de alta disponibilidad para todos los componentes debe ser mcc.

+
|===


| Si la configuración de MetroCluster tiene... | El estado de alta disponibilidad debería ser... 


 a| 
Dos nodos
 a| 
mcc-2n



 a| 
Cuatro u ocho nodos
 a| 
mcc

|===
. Si el estado del sistema mostrado del controlador no es correcto, configure el estado de alta disponibilidad para el módulo de la controladora y el chasis:
+
|===


| Si la configuración de MetroCluster tiene... | Emita estos comandos... 


 a| 
*Dos nodos*
 a| 
`ha-config modify controller mcc-2n`

`ha-config modify chassis mcc-2n`



 a| 
*Cuatro u ocho nodos*
 a| 
`ha-config modify controller mcc`

`ha-config modify chassis mcc`

|===




=== Reasignar discos de agregado raíz

Reasigne los discos del agregado raíz al nuevo módulo de la controladora mediante los sides recogidos anteriormente

.Acerca de esta tarea
Esta tarea se realiza en modo de mantenimiento.

Los ID antiguos del sistema se identificaron en link:task_upgrade_controllers_in_a_four_node_fc_mcc_us_switchover_and_switchback_mcc_fc_4n_cu.html["Obteniendo información antes de la actualización"].

Los ejemplos de este procedimiento utilizan controladoras con los siguientes ID de sistema:

|===


| Nodo | ID del sistema antiguo | Nuevo ID del sistema 


 a| 
Node_B_1
 a| 
4068741254
 a| 
1574774970

|===
.Pasos
. Conecte el resto de conexiones a los nuevos módulos de controladora (FC-VI, almacenamiento, interconexión de clúster, etc.).
. Detenga el sistema e inicie en modo de mantenimiento desde la `LOADER` prompt:
+
`boot_ontap maint`

. Muestre los discos propiedad de node_B_1-A700:
+
`disk show -a`

+
El resultado de ejemplo muestra el ID del sistema del nuevo módulo de controlador (1574774970). Sin embargo, los discos del agregado raíz siguen siendo propiedad del ID de sistema anterior (4068741254). En este ejemplo, no se muestran las unidades que pertenecen a otros nodos en la configuración MetroCluster.

+
[listing]
----
*> disk show -a
Local System ID: 1574774970

  DISK         OWNER                     POOL   SERIAL NUMBER    HOME                      DR HOME
------------   -------------             -----  -------------    -------------             -------------
...
rr18:9.126L44 node_B_1-A700(4068741254)   Pool1  PZHYN0MD         node_B_1-A700(4068741254)  node_B_1-A700(4068741254)
rr18:9.126L49 node_B_1-A700(4068741254)   Pool1  PPG3J5HA         node_B_1-A700(4068741254)  node_B_1-A700(4068741254)
rr18:8.126L21 node_B_1-A700(4068741254)   Pool1  PZHTDSZD         node_B_1-A700(4068741254)  node_B_1-A700(4068741254)
rr18:8.126L2  node_B_1-A700(4068741254)   Pool0  S0M1J2CF         node_B_1-A700(4068741254)  node_B_1-A700(4068741254)
rr18:8.126L3  node_B_1-A700(4068741254)   Pool0  S0M0CQM5         node_B_1-A700(4068741254)  node_B_1-A700(4068741254)
rr18:9.126L27 node_B_1-A700(4068741254)   Pool0  S0M1PSDW         node_B_1-A700(4068741254)  node_B_1-A700(4068741254)
...
----
. Reasigne los discos de agregado raíz de las bandejas de unidades a la nueva controladora:
+
`disk reassign -s _old-sysid_ -d _new-sysid_`

+
En el siguiente ejemplo, se muestra la reasignación de unidades:

+
[listing]
----
*> disk reassign -s 4068741254 -d 1574774970
Partner node must not be in Takeover mode during disk reassignment from maintenance mode.
Serious problems could result!!
Do not proceed with reassignment if the partner is in takeover mode. Abort reassignment (y/n)? n

After the node becomes operational, you must perform a takeover and giveback of the HA partner node to ensure disk reassignment is successful.
Do you want to continue (y/n)? Jul 14 19:23:49 [localhost:config.bridge.extra.port:error]: Both FC ports of FC-to-SAS bridge rtp-fc02-41-rr18:9.126L0 S/N [FB7500N107692] are attached to this controller.
y
Disk ownership will be updated on all disks previously belonging to Filer with sysid 4068741254.
Do you want to continue (y/n)? y
----
. Compruebe que todos los discos se reasignan según se espera: `disk show`
+
[listing]
----
*> disk show
Local System ID: 1574774970

  DISK        OWNER                      POOL   SERIAL NUMBER   HOME                      DR HOME
------------  -------------              -----  -------------   -------------             -------------
rr18:8.126L18 node_B_1-A900(1574774970)   Pool1  PZHYN0MD        node_B_1-A900(1574774970)  node_B_1-A900(1574774970)
rr18:9.126L49 node_B_1-A900(1574774970)   Pool1  PPG3J5HA        node_B_1-A900(1574774970)  node_B_1-A900(1574774970)
rr18:8.126L21 node_B_1-A900(1574774970)   Pool1  PZHTDSZD        node_B_1-A900(1574774970)  node_B_1-A900(1574774970)
rr18:8.126L2  node_B_1-A900(1574774970)   Pool0  S0M1J2CF        node_B_1-A900(1574774970)  node_B_1-A900(1574774970)
rr18:9.126L29 node_B_1-A900(1574774970)   Pool0  S0M0CQM5        node_B_1-A900(1574774970)  node_B_1-A900(1574774970)
rr18:8.126L1  node_B_1-A900(1574774970)   Pool0  S0M1PSDW        node_B_1-A900(1574774970)  node_B_1-A900(1574774970)
*>
----
. Mostrar el estado del agregado: `aggr status`
+
[listing]
----
*> aggr status
           Aggr            State       Status           Options
aggr0_node_b_1-root    online      raid_dp, aggr    root, nosnap=on,
                           mirrored                     mirror_resync_priority=high(fixed)
                           fast zeroed
                           64-bit
----
. Repita los pasos anteriores en el nodo asociado (node_B_2-A900).




=== Arranque las nuevas controladoras

Debe reiniciar los controladores desde el menú de arranque para actualizar la imagen flash de la controladora. Se requieren pasos adicionales si está configurado el cifrado.

.Acerca de esta tarea
Esta tarea debe realizarse en todas las controladoras nuevas.

.Pasos
. Detenga el nodo: `halt`
. Si se configura el gestor de claves externo, defina los bootargs relacionados:
+
`setenv bootarg.kmip.init.ipaddr _ip-address_`

+
`setenv bootarg.kmip.init.netmask _netmask_`

+
`setenv bootarg.kmip.init.gateway _gateway-address_`

+
`setenv bootarg.kmip.init.interface _interface-id_`

. Mostrar el menú de inicio: `boot_ontap menu`
. Si se utiliza el cifrado de raíz, ejecute el comando de menú de inicio para la configuración de administración de claves.
+
|===


| Si está usando... | Seleccione esta opción del menú de inicio... 


 a| 
Gestión de claves incorporada
 a| 
Opción 10 y siga las instrucciones para proporcionar las entradas necesarias para recuperar o restaurar la configuración de Key-Manager



 a| 
Gestión de claves externas
 a| 
Opción 11 y siga las instrucciones para proporcionar las entradas necesarias para recuperar o restaurar la configuración de Key-Manager

|===
. Si está activado el arranque automático, interrumpa el arranque automático pulsando control-C.
. Desde el menú de inicio, ejecute la opción (6).
+

NOTE: La opción 6 reiniciará el nodo dos veces antes de que finalice.

+
Responda `y` a las peticiones de cambio de id del sistema. Espere a que aparezcan los segundos mensajes de reinicio:

+
[listing]
----
Successfully restored env file from boot media...

Rebooting to load the restored env file...
----
. Compruebe que la sísid del compañero es correcta: `printenv partner-sysid`
+
Si el sid del socio no es correcto, configúrelo: `setenv partner-sysid _partner-sysID_`

. Si se utiliza el cifrado de raíz, vuelva a ejecutar el comando de menú de inicio para la configuración de administración de claves.
+
|===


| Si está usando... | Seleccione esta opción del menú de inicio... 


 a| 
Gestión de claves incorporada
 a| 
Opción 10 y siga las instrucciones para proporcionar las entradas necesarias para recuperar o restaurar la configuración de Key-Manager



 a| 
Gestión de claves externas
 a| 
Opción 11 y siga las instrucciones para proporcionar las entradas necesarias para recuperar o restaurar la configuración de Key-Manager

|===
+
Puede que tenga que emitir el `recover_xxxxxxxx_keymanager` en el símbolo del sistema del menú de arranque varias veces hasta que los nodos arrancen por completo.

. Arrancar los nodos: `boot_ontap`
. Espere a que los nodos sustituidos se inicien.
+
Si alguno de los nodos está en modo de toma de control, realice una devolución mediante el `storage failover giveback` comando.

. Verifique que todos los puertos estén en un dominio de retransmisión:
+
.. Vea los dominios de retransmisión:
+
`network port broadcast-domain show`

.. Añada cualquier puerto a un dominio de retransmisión según sea necesario.
+
link:https://docs.netapp.com/us-en/ontap/networking/add_or_remove_ports_from_a_broadcast_domain97.html["Añada o quite puertos de un dominio de retransmisión"^]

.. Agregue el puerto físico que alojará las LIF de interconexión de clústeres en el dominio de retransmisión correspondiente.
.. Modifique las LIF de interconexión de clústeres para usar el puerto físico nuevo como puerto principal.
.. Después de poner en marcha las LIF de interconexión de clústeres, compruebe el estado de paridad del clúster y vuelva a establecer la relación de clústeres entre iguales según sea necesario.
+
Es posible que deba volver a configurar la relación de clústeres entre iguales.

+
link:https://docs.netapp.com/us-en/ontap-metrocluster/install-fc/concept_configure_the_mcc_software_in_ontap.html#peering-the-clusters["Creación de una relación de paridad entre clústeres"]

.. Vuelva a crear las VLAN y los grupos de interfaces según sea necesario.
+
La pertenencia a la VLAN y al grupo de interfaces puede ser diferente de la del nodo antiguo.

+
link:https://docs.netapp.com/us-en/ontap/networking/configure_vlans_over_physical_ports.html#create-a-vlan["Creación de una VLAN"^]

+
link:https://docs.netapp.com/us-en/ontap/networking/combine_physical_ports_to_create_interface_groups.html["Combinación de puertos físicos para crear grupos de interfaces"^]



. Si se utiliza el cifrado, restaure las claves con el comando correcto para la configuración de gestión de claves.
+
|===


| Si está usando... | Se usa este comando... 


 a| 
Gestión de claves incorporada
 a| 
`security key-manager onboard sync`

Para obtener más información, consulte link:https://docs.netapp.com/us-en/ontap/encryption-at-rest/restore-onboard-key-management-encryption-keys-task.html["Restauración de las claves de cifrado de gestión de claves incorporadas"^].



 a| 
Gestión de claves externas
 a| 
`security key-manager external restore -vserver _SVM_ -node _node_ -key-server _host_name|IP_address:port_ -key-id key_id -key-tag key_tag _node-name_`

Para obtener más información, consulte link:https://docs.netapp.com/us-en/ontap/encryption-at-rest/restore-external-encryption-keys-93-later-task.html["Restauración de claves de cifrado de gestión de claves externas"^].

|===




=== Compruebe la configuración de LIF

Verifique que los LIF se alojan en el nodo o los puertos adecuados antes de regresar. Deben realizarse los siguientes pasos

.Acerca de esta tarea
Esta tarea se realiza en site_B, donde los nodos se han iniciado con agregados raíz.

.Pasos
. Verifique que los LIF se alojan en el nodo y los puertos apropiados antes de regresar.
+
.. Cambie al nivel de privilegio avanzado:
+
`set -privilege advanced`

.. Anule la configuración de puertos para garantizar una ubicación correcta de las LIF:
+
`vserver config override -command "network interface modify" -vserver _vserver_name_ -home-port _active_port_after_upgrade_ -lif _lif_name_ -home-node _new_node_name_"`

+
Al introducir la `network interface modify` dentro de `vserver config override` no se puede utilizar la función de tabulación automática. Puede crear el `network interface modify` con la opción de autocompletar y, a continuación, escríbala en la `vserver config override` comando.

.. Vuelva al nivel de privilegio de administrador: +
`set -privilege admin`


. Revierte las interfaces a su nodo de inicio:
+
`network interface revert * -vserver _vserver-name_`

+
Realice este paso en todas las SVM según sea necesario.





== Vuelva a cambiar la configuración de MetroCluster

Una vez configuradas las nuevas controladoras, volverá a cambiar la configuración de MetroCluster para que la configuración regrese a su funcionamiento normal.

.Acerca de esta tarea
En esta tarea, realizará la operación de conmutación de estado y regresará la configuración de MetroCluster al funcionamiento normal. Los nodos del sitio_A aún están esperando una actualización tal y como se muestra en la siguiente ilustración. (Esta ilustración también se aplica a la actualización de FAS9000 a una controladora FAS9500).

image::../media/mcc_upgrade_cluster_a_switchback_A900.png[MetroCluster de cuatro nodos]

.Pasos
. Emita el `metrocluster node show` Comando en site_B y compruebe la salida.
+
.. Compruebe que los nodos nuevos se representen correctamente.
.. Verifique que los nuevos nodos estén en "esperando el estado de conmutación de estado".


. Regreso al clúster:
+
`metrocluster switchback`

. Compruebe el progreso de la operación de regreso:
+
`metrocluster show`

+
La operación de conmutación de estado aún está en curso cuando se muestra el resultado `waiting-for-switchback`:

+
[listing]
----
cluster_B::> metrocluster show
Cluster                   Entry Name          State
------------------------- ------------------- -----------
 Local: cluster_B         Configuration state configured
                          Mode                switchover
                          AUSO Failure Domain -
Remote: cluster_A         Configuration state configured
                          Mode                waiting-for-switchback
                          AUSO Failure Domain -
----
+
La operación de regreso se completa cuando se muestra el resultado `normal`:

+
[listing]
----
cluster_B::> metrocluster show
Cluster                   Entry Name          State
------------------------- ------------------- -----------
 Local: cluster_B         Configuration state configured
                          Mode                normal
                          AUSO Failure Domain -
Remote: cluster_A         Configuration state configured
                          Mode                normal
                          AUSO Failure Domain -
----
+
Si una conmutación de regreso tarda mucho tiempo en terminar, puede comprobar el estado de las líneas base en curso utilizando el `metrocluster config-replication resync-status show` comando. Este comando se encuentra en el nivel de privilegio avanzado.





== Compruebe el estado de la configuración de MetroCluster

Después de actualizar los módulos de controladora, debe verificar el estado de la configuración de MetroCluster.

.Acerca de esta tarea
Esta tarea se puede realizar en cualquier nodo de la configuración de MetroCluster.

.Pasos
. Compruebe el funcionamiento de la configuración de MetroCluster:
+
.. Confirme la configuración del MetroCluster y que el modo operativo es normal:
+
`metrocluster show`

.. Realizar una comprobación de MetroCluster:
+
`metrocluster check run`

.. Mostrar los resultados de la comprobación de MetroCluster:
+
`metrocluster check show`

+
Después de ejecutar el `metrocluster check run` y.. `metrocluster check show` comandos, es posible que se muestre un error similar al siguiente ejemplo:

+
[listing]
----
Cluster_A:: node_A_1 (non-overridable veto): DR partner NVLog mirroring is not online. Make sure that the links between the two sites are healthy and properly configured.
----
+
Este error se produce debido a una discrepancia de la controladora durante el proceso de actualización. Puede ignorar con seguridad el error y continuar con la actualización de los nodos en SITE_A.







== Actualice los nodos en site_A

Debe repetir las tareas de actualización en site_A.

.Paso
. Repita los pasos para actualizar los nodos en el sitio_A, empezando por link:task_upgrade_controllers_in_a_four_node_fc_mcc_us_switchover_and_switchback_mcc_fc_4n_cu.html["Prepare la actualización"].
+
Al realizar las tareas, se invierten todas las referencias de ejemplo a los sitios y nodos. Por ejemplo, cuando se da el ejemplo para cambiar de sitio_A, se cambiará de Site_B.





== Envíe un mensaje personalizado de AutoSupport tras el mantenimiento

Después de completar la actualización, debe enviar un mensaje de AutoSupport que indique el fin del mantenimiento para que se pueda reanudar la creación automática de casos.

.Paso
. Para reanudar la generación automática de casos de soporte, envíe un mensaje de AutoSupport para indicar que se ha completado el mantenimiento.
+
.. Emita el siguiente comando:
+
`system node autosupport invoke -node * -type all -message MAINT=end`

.. Repita el comando en el clúster de partners.






== Supervisión de tiebreaker para restaurar

Si la configuración de MetroCluster se ha configurado previamente para la supervisión por parte del software Tiebreaker, puede restaurar la conexión de tiebreaker.

. Siga los pasos que se indican a continuación: link:../tiebreaker/concept_configuring_the_tiebreaker_software.html#add-metrocluster-configurations["Adición de configuraciones de MetroCluster"] en la sección _Instalación y configuración de MetroCluster Tiebreaker_.

